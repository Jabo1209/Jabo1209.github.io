<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Lab Meeting</title>
    <link rel="icon" type="image/jpeg" href="./lab-meeting-tab.jpg">
    <link rel="shortcut icon" href="./lab-meeting-tab.jpg">
    <meta property="og:description" content="Lab Meeting">
    <meta property="og:image" content="./preview.jpg">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jabo1209.github.io/lab-meeting">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { 
            --bg: #121212; 
            --container-bg: #1e1e1e;
            --cell-height: 75px; 
            --border-color: #333;
            --text-color: #e0e0e0;
            /* æ–¹æ¡ˆ Cï¼šé›»å…‰ç´« (Electric Purple) - æ·±è‰²æ¨¡å¼çš„å®˜æ–¹å¼·èª¿è‰² */
            --highlight-color: #bb86fc; 
        }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text-color); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 1150px; background: var(--container-bg); padding: 20px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        .header-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        
        button { padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; border: 1px solid #444; background: #333; color: white; transition: 0.2s; }
        .btn-img { background: #03dac6; color: #000; border: none; } /* é’è‰²æŒ‰éˆ•èˆ‡ç´«è‰²æ˜¯çµ•é… */
        .btn-save { background: #3700b3; color: white; border: none; }
        .btn-edit { background: #cf6679; color: white; border: none; }
        .btn-load { background: #f5f5f5; color: #222; border: none; }

        .student-selector { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 20px; padding: 12px; background: #252525; border-radius: 8px; border: 1px dashed #444; min-height: 50px; }
        .stu-btn { border: 2px solid #444; background: #2c2c2c; border-radius: 20px; padding: 6px 15px; cursor: pointer; color: #bbb; }
        .stu-btn.active { background: var(--highlight-color); color: #000; border-color: var(--highlight-color); font-weight: bold; }

        #editSection { display: none; background: #2a1a2c; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #4a3350; text-align: center; }
        #newStuName { padding: 8px; border-radius: 4px; border: 1px solid #444; background: #121212; color: white; width: 150px; }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; background: #1a1a1a; }
        th, td { border: 1px solid var(--border-color); text-align: center; vertical-align: top; padding: 5px; }
        th { background: #252525; color: #bb86fc; font-size: 14px; }
        .time-col { background: #252525; font-weight: bold; font-size: 0.8em; width: 90px; height: var(--cell-height); color: #888; }
        
        /* é¸èª²æ ¼å­é¡è‰²ï¼šé›»å…‰ç´« */
        .slot { cursor: pointer; transition: 0.1s; }
        .has-class { background-color: var(--highlight-color) !important; }
        
        /* ç´«è‰²èƒŒæ™¯æ™‚ï¼Œå§“åæ¨™ç±¤æ”¹ç‚ºæ·±è‰²é€æ˜ï¼Œæ–‡å­—ç‚ºé»‘è‰²ä»¥ä¿æŒé«˜å°æ¯” */
        .has-class .name-tag { 
            color: #000 !important; 
            background: rgba(255, 255, 255, 0.3); 
            border-color: rgba(0, 0, 0, 0.2); 
            font-weight: bold;
        }
        
        .name-tag { 
            display: inline-block; 
            background: rgba(187, 134, 252, 0.15); 
            color: #bb86fc; 
            padding: 2px 7px; 
            margin: 2px; 
            border-radius: 4px; 
            font-size: 0.8em; 
            border: 1px solid rgba(187, 134, 252, 0.3); 
        }
        .hide-names .name-tag { display: none; }
        .empty-hint { color: #666; font-style: italic; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <h2>ğŸ”¬ Lab Meeting</h2>
        <div class="button-group">
            <label style="font-size: 0.9em; font-weight: bold; cursor: pointer;"><input type="checkbox" id="showNameToggle" checked onchange="toggleNameDisplay()"> é¡¯ç¤ºå§“å</label>
            <button class="btn-edit" onclick="toggleEditMode()">âœï¸ ç·¨è¼¯åå–®</button>
            <button class="btn-img" onclick="exportImage()">ğŸ“¸ ä¸‹è¼‰åœ–ç‰‡</button>
            <button class="btn-save" onclick="saveToFile()">ğŸ’¾ åŒ¯å‡ºå‚™ä»½</button>
            <button class="btn-load" onclick="document.getElementById('fileInput').click()">ğŸ“‚ åŒ¯å…¥å‚™ä»½</button>
            <input type="file" id="fileInput" style="display:none" accept=".json" onchange="loadFromFile(event)">
        </div>
    </div>
    <div id="editSection"><input type="text" id="newStuName" placeholder="è¼¸å…¥å­¸ç”Ÿå§“å" onkeypress="if(event.keyCode==13) addStudent()"><button onclick="addStudent()">â• æ–°å¢æˆå“¡</button></div>
    <div class="student-selector" id="studentSelector"></div>
    <div id="captureArea" style="background: #121212; padding: 5px;"><table id="mainTable"><thead><tr><th>æ™‚æ®µ</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th></tr></thead><tbody id="timetableBody"></tbody></table></div>
</div>

<script>
    let students = []; let scheduleData = {}; let currentStudent = ""; let isEditMode = false;
    const sessions = Array.from({length: 13}, (_, i) => ({id: i+1}));
    function init() { renderStudentBtns(); renderTable(); }
    function renderStudentBtns() {
        const selector = document.getElementById('studentSelector');
        if (students.length === 0) { selector.innerHTML = '<span class="empty-hint">è«‹åŒ¯å…¥ JSON å‚™ä»½æˆ–é»æ“Šç·¨è¼¯åå–®</span>'; return; }
        selector.innerHTML = '';
        students.forEach(name => {
            const btn = document.createElement('button');
            btn.className = 'stu-btn' + (name === currentStudent ? ' active' : '');
            btn.innerHTML = name + (isEditMode ? `<span class="del-stu" onclick="removeStudent(event, '${name}')">Ã—</span>` : '');
            if (!isEditMode) btn.onclick = () => { document.querySelectorAll('.stu-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); currentStudent = name; };
            selector.appendChild(btn);
        });
    }
    function toggleEditMode() { isEditMode = !isEditMode; document.getElementById('editSection').style.display = isEditMode ? 'block' : 'none'; renderStudentBtns(); }
    function addStudent() { const nameInput = document.getElementById('newStuName'); const name = nameInput.value.trim(); if (name && !students.includes(name)) { students.push(name); if (!currentStudent) currentStudent = name; nameInput.value = ''; renderStudentBtns(); } }
    function removeStudent(event, name) { event.stopPropagation(); if (confirm(`ç¢ºå®šåˆªé™¤ ${name}ï¼Ÿ`)) { students = students.filter(s => s !== name); for (let key in scheduleData) { scheduleData[key] = scheduleData[key].filter(s => s !== name); } if (currentStudent === name) currentStudent = students[0] || ""; renderStudentBtns(); renderTable(); } }
    function toggleNameDisplay() { const table = document.getElementById('mainTable'); document.getElementById('showNameToggle').checked ? table.classList.remove('hide-names') : table.classList.add('hide-names'); }
    function toggleSlot(day, sid) { if (isEditMode || !currentStudent) return; const key = `${day}-${sid}`; if (!scheduleData[key]) scheduleData[key] = []; const idx = scheduleData[key].indexOf(currentStudent); if (idx > -1) scheduleData[key].splice(idx, 1); else scheduleData[key].push(currentStudent); renderTable(); }
    function renderTable() {
        const body = document.getElementById('timetableBody'); body.innerHTML = '';
        sessions.forEach(s => {
            let row = `<tr><td class="time-col">ç¬¬ ${s.id} ç¯€</td>`;
            for (let d = 1; d <= 5; d++) {
                const list = scheduleData[`${d}-${s.id}`] || [];
                let c = list.length > 0 ? 'has-class' : '';
                const tags = list.map(n => `<span class="name-tag">${n}</span>`).join('');
                row += `<td class="slot ${c}" onclick="toggleSlot(${d}, ${s.id})">${tags}</td>`;
            }
            row += `</tr>`; body.innerHTML += row;
        });
    }
    function saveToFile() { const blob = new Blob([JSON.stringify({ students, scheduleData }, null, 2)], {type: "application/json"}); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = "schedule_backup.json"; link.click(); }
    function loadFromFile(event) {
        const file = event.target.files[0]; if (!file) return; const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (imported.students) { students = imported.students; scheduleData = imported.scheduleData || {}; }
                else { scheduleData = imported; let extracted = new Set(); Object.values(scheduleData).forEach(arr => arr.forEach(n => extracted.add(n))); students = Array.from(extracted); }
                currentStudent = students[0] || ""; renderStudentBtns(); renderTable();
            } catch (err) { alert("è®€å–å¤±æ•—"); }
        };
        reader.readAsText(file);
    }
    function exportImage() { html2canvas(document.getElementById('captureArea'), { backgroundColor: '#121212' }).then(canvas => { const link = document.createElement('a'); link.download = `Schedule.png`; link.href = canvas.toDataURL(); link.click(); }); }
    window.onload = init;
</script>
</body>
</html>